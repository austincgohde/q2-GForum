<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>gForum</title>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/prefixfree/1.0.7/prefixfree.min.js"></script>
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <link rel="stylesheet" href="/style.css">
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css?family=Mada|Six+Caps|Grand+Hotel" rel="stylesheet">
      <link rel="shortcut icon" href="/titlepic.jpeg">
      <link rel="apple-touch-icon" href="/titlepic.jpeg">

  </head>
  <ul class = "navbar" style="list-style: none;">
    <li><span class = "smallLogo">gForum</li>
    <li><a class="active" href="/overview">HOME</a></li>
    <li><a class="active" href="/logout">LOG OUT</a></li>
    <li><a class="active" href="https://www.galvanize.com/phoenix">GALVANIZE</a></li>
    <li><a class="active" href="https://learn.galvanize.com/">LEARN</a></li>
    <li><a class="active" href="https://members.galvanize.com/">MEMBER</a></li>
    <li><a class="active" href="https://talent.galvanize.com/">TALENT</a></li>
    <li><a class="active" href="https://gstudents.slack.com/">SLACK</a></li>
    <li><a class="active" href="https://github.com/">GITHUB</a></li>
    <li><a class="active" href="https://trello.com/">TRELLO</a></li>
  </ul>
  <br>
  <br>
  <body class = "postBody">
  <div class = "sectionDiv">
    <p id = "logoTitle">Post:</p>
    <div class = "line"></div>
    <div id = "postTable">
        <p id = "contentTimestamp">Created on<%= post.created_at %></p>
        <p id = "contentTitle"><%= post.title %><p>
        <p id = "contentAuthor"> by <%= post.first_name %> <%= post.last_name %><p>
        <p id = "content"><%= post.content %><p>
          <button class = "postUp" onclick="postUpFn(<%= post.id %>)">&#8593;<%= post.upvote %> Upvotes</button>
          <button class = "postDown" onclick="postDownFn(<%= post.id %>)">&#8595; <%= post.downvote %> Downvotes</button>
  </div>
  </div>
  <div class = "sectionDiv">
    <p id = "logoTitle">Comments:</p>
    <div class = "line"></div>
  </div>
  <div class = "interestingsDiv">
    <% for(let i = 0; i < comments.length; i++) { %>
      <div id = "postTable">
      <p id = "contentTimestamp">Created on<%= comments[i].created_at %></p>
      <p id = "contentAuthor"> by <%= comments[i].first_name %> <%= comments[i].last_name %><p>
      <p id = "content"><%= comments[i].content %><p>
      <button class = "commentUp" onclick="commentUpFn(<%= comments[i].id %>)">&#8593;<%= comments[i].upvote %> Upvotes</button>
      <button class = "commentDown" onclick="commentDownFn(<%= comments[i].id %>)">&#8593;<%= comments[i].downvote %> Downvotes</button>
      </div>
    <% } %>
  </div>
  <div class = 'newSubmit'>
    <p id = "logoTitle"> New Comment:</p>
    <div class = "line"></div>
  <form action="/comment/create" method="post" id = "newInteresting">
      <textarea id = "textArea" name="content" form="newInteresting" cols="138" rows="10" placeholder="Enter comment here"></textarea>
      <br>
      <button type="submit" id="submitButton">Submit!</button>
    </form>
  </div>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <ul class = "footer" style="list-style: none;">
    <li><a class="active" >&copy; 2017 gForum - By g66: Charlotte-Anne Spencer | Austin Gohde | Trevor Young</li>
  </ul>

</body>
<script type="text/javascript">

let postUpFn = (num) => {
  $.get(("/upvote/post/"+num), (data) => {

    let upTag = document.getElementsByClassName("postUp")
    let index = 0

    for(let i = 0; i < upTag.length; i++) {
      if(upTag[i].attributes.onclick.value.includes(num)) {
        return index = i;
      }
    }

    console.log(index);
    $(".postUp"[index]).text(`${data.upvote}`)
    $(".postUp"[index]).attr("onclick", "")
  })
};

</script>
</html>
